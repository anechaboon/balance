import{A as r}from"./tenant.service-713d1294.js";import{P as _}from"./PlaceholderContent-9fa4866e.js";import{h as p}from"./moment-fbc5633a.js";import{_ as g,r as v,o as u,d as y,c as f,a,b as m,V as k,t as I,F as x,m as S,w as h,u as L,x as C,v as w}from"./index-a94dd109.js";const b={name:"CheckList",components:{PlaceholderContent:_},data(){return{onload:!0,total:0,checkList:[],checked:!0,walletId:parseInt(localStorage.getItem("walletId")),indexId:0,wallet:{},walletListId:[]}},async mounted(){await this.feedData(),this.getWallets(),this.onload=!1},methods:{async feedData(t=!1){const e=`?sort=desc&walletId=${this.walletId}`;let l=await r.CheckList.get(e);if(l.data.length>0)for(let c in l.data){let n=l.data[c];n.checked==1&&(n.checked=!0)}let s=!1,i=localStorage.getItem(`checkListData${this.walletId}`);if(i==""||i==null||i=="null"||i==null||i!=null&&i.length==0?(s=void 0,localStorage.removeItem(`checkListData${this.walletId}`)):s=JSON.parse(i),this.walletId==0&&(s=await this.getAllWallet()),l.data[0]!=null&&s!=null&&this.walletId>0){const c=new Date(l.data[0].created_date);new Date(s[0].created_date)>c?this.checkList=s:this.checkList=l.data,t=!1}else l.data[0]!=null&&this.walletId>0?this.checkList=l.data:s!=null&&(this.checkList=s);t&&s==null&&(this.checkList=l.data),this.checkList.length>0&&this.calculateTotal()},async calculateTotal(){let t=0;for(let e in this.checkList){let l=this.checkList[e];if(l.amount!=null&&l.amount!=""&&l.amount!=null){let s=parseFloat(l.amount);t+=parseFloat(s)}}this.total=t},async getAllWallet(){let t=[];if(this.walletId==0)for(let e in this.walletListId){let l=localStorage.getItem(`checkListData${this.walletListId[e].id}`);l!=null&&(l=JSON.parse(l),t=[...t,...l])}return t},async buy(){const t=this.checkList.filter(s=>s.checked==!0);let e={wallet_id:this.walletId,check_list:JSON.parse(JSON.stringify(t))};if(await r.CheckList.buy(e)){const s=this.checkList.filter(c=>c.checked!=!0),i=JSON.stringify(s);localStorage.setItem(`checkListData${this.walletId}`,i),this.checkList=s}},async saveCheckList(){let t={wallet_id:this.walletId,check_list:JSON.parse(JSON.stringify(this.checkList))};setTimeout(function(){r.CheckList.add(t)},30)},checkedList(){let t=this;t.walletId>0?setTimeout(function(){let e=JSON.stringify(t.checkList);localStorage.setItem(`checkListData${t.walletId}`,e)},30):setTimeout(function(){t.updateCheckList()},30)},async updateCheckList(){let t="";for(let e in this.checkList){let l=this.checkList[e];t=`checkListData${l.wallet_id}`;let s=JSON.parse(localStorage.getItem(t))||[];const i=s.findIndex(c=>c.id===l.id);i>=0?(s[i].memo=l.memo,s[i].amount=l.amount,s[i].checked=l.checked,s[i].status=l.status):s.push(l),s=s.filter(function(c){return c.status=="1"}),localStorage.setItem(t,JSON.stringify(s))}this.walletId==0?this.checkList=await this.getAllWallet():this.checkList=JSON.parse(localStorage.getItem(t))},addItem(){this.checkList.push({id:this.generateString(5).trim(),memo:"",amount:"",checked:!1,user_id:localStorage.getItem("balanceUserId"),wallet_id:this.walletId,status:"1"})},keyCheckList(){var t=0;let e=this;const l=p(new Date).format("YYYY-MM-DD H:mm:ss");for(let s=0;s<this.checkList.length;s++)this.checkList[s].created_date=l;this.total=t,setTimeout(function(){e.updateCheckList(),e.calculateTotal()},10)},removeItem(t){const e=this.checkList.findIndex(l=>l.id===t);e>=0&&(this.checkList[e].status=0),this.keyCheckList()},generateString(t){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let l=" ";const s=e.length;for(let i=0;i<t;i++)l+=e.charAt(Math.floor(Math.random()*s));return l},async getWallets(){let t=await r.Wallet.getWallets();if(t.status==200){this.walletList=t.data;let e=[{id:0,title:"All"}];this.wallet=t.data.find(s=>s.id==this.walletId),t.data.forEach(function(s){e.push({id:s.id,title:s.title})}),this.walletListId=e;let l=this;this.indexId=this.walletListId.findIndex(s=>s.id==l.walletId)}},async preWallet(){let t=this;this.indexId-=1,this.wallet=this.walletListId[this.indexId],this.walletId=this.wallet.id,setTimeout(function(){t.feedData(!0)},30)},async nextWallet(){let t=this;this.indexId+=1,this.wallet=this.walletListId[this.indexId],this.walletId=this.wallet.id,setTimeout(function(){t.feedData(!0)},30)}}},D={key:1,class:"m-05em mx-2 h-107"},N={class:"p-2 border-radius pink"},J={class:"row"},O={class:"col-2"},T={class:"col-8 text-center"},V={class:"col-2"},W={class:"py-2 pr-2",id:"all-check-list"},A={class:"col-1 mr-1 mt-1"},U=["onUpdate:modelValue"],B={class:"col-7"},F=["onUpdate:modelValue","disabled"],M={class:"col-3 mr-1 ml-1"},Y=["onUpdate:modelValue","disabled"],z={class:"col-1 pt-1"},j=["onClick"],E={class:"form-check pt-2 pl-1 d-flex"},P={class:"col-6"},q={class:"col-6 row"},H=a("div",{class:"float-left col-4"},"Total:",-1),K={class:"float-right col-8"},G={class:"d-flex pt-2"},Q={class:"col-2"},R=a("div",{class:"col-8"},null,-1),X={class:"col-2"};function Z(t,e,l,s,i,c){const n=v("placeholder-content");return i.onload?(u(),y(n,{key:0,"is-load":"true"})):(u(),f("div",D,[a("div",N,[a("div",J,[a("div",O,[m(k,{icon:"mdi-chevron-left-circle",height:"40",variant:"text",width:"40",onClick:e[0]||(e[0]=d=>c.preWallet()),disabled:i.indexId==0},null,8,["disabled"])]),a("div",T,[a("h1",null,I(i.wallet.title),1)]),a("div",V,[m(k,{icon:"mdi-chevron-right-circle",height:"40",variant:"text",width:"40",onClick:e[1]||(e[1]=d=>c.nextWallet()),disabled:i.indexId==i.walletListId.length-1},null,8,["disabled"])])]),a("div",W,[(u(!0),f(x,null,S(i.checkList,d=>(u(),f("div",{class:"form-check pb-1 d-flex col-12 p-0 pt-2",key:d.id},[a("div",A,[h(a("input",{class:"form-control checkbox-size-1",type:"checkbox","onUpdate:modelValue":o=>d.checked=o,onClick:e[2]||(e[2]=(...o)=>c.checkedList&&c.checkedList(...o))},null,8,U),[[C,d.checked]])]),a("div",B,[h(a("input",{class:"form-control",type:"text","onUpdate:modelValue":o=>d.memo=o,disabled:d.checked==1,placeholder:"item",onChange:e[3]||(e[3]=o=>c.keyCheckList())},null,40,F),[[w,d.memo]])]),a("div",M,[h(a("input",{class:"form-control",type:"number","onUpdate:modelValue":o=>d.amount=o,disabled:d.checked==1,placeholder:"amount",onChange:e[4]||(e[4]=o=>c.keyCheckList())},null,40,Y),[[w,d.amount]])]),a("div",z,[a("i",{class:"fa-solid fa-circle-minus text-danger",style:"font-size: 25px;",onClick:o=>c.removeItem(d.id)},null,8,j)])]))),128)),a("div",E,[a("div",P,[h(a("i",{class:"fa-solid fa-circle-plus text-primary col-6",style:"font-size: 30px;",onClick:e[5]||(e[5]=(...d)=>c.addItem&&c.addItem(...d))},null,512),[[L,i.walletId!=0]])]),a("div",q,[H,a("div",K,I(t.$filters.formatNumber(i.total)),1)])])])]),a("div",G,[a("div",Q,[a("button",{class:"btn btn-success",onClick:e[6]||(e[6]=d=>c.saveCheckList())},"Save")]),R,a("div",X,[h(a("button",{class:"btn btn-primary",onClick:e[7]||(e[7]=d=>c.buy())},"Buy",512),[[L,i.walletId!=0]])])])]))}const lt=g(b,[["render",Z]]);export{lt as default};
